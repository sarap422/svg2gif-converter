# SVG to GIF Converter

SVGアニメーションをGIFアニメーションに変換するPythonツールです。CSS animationやSMILアニメーションを含むSVGアニメーションを、GIFアニメーションに変換できます。

## バージョン 1.1.2

### 主な特徴

- **アニメーション自動検出**: SVGファイルからアニメーション時間を自動検出
- **個別要素のタイミング制御**: `animation-delay`を持つ各要素を独立して制御
- **柔軟な再生時間設定**: 総再生時間を自由に調整（自然なループ）
- **フェード効果**: フェードイン/アウト、開始前/終了後の空白時間
- **デバッグモード**: アニメーション解析の詳細情報出力
- **高品質出力**: 2倍解像度でキャプチャしてクリアなGIFを生成

## 動作環境

- **Python**: 3.7以上
- **OS**: Windows 10/11, macOS 10.14+, Linux (Ubuntu 18.04+)
- **ブラウザ**: Google Chrome（自動インストール）

## インストール

### 1. 必要なライブラリのインストール

```bash
# Windowsの場合（python -m pipを使用）
python -m pip install pillow selenium webdriver-manager

# macOS/Linuxの場合
pip install pillow selenium webdriver-manager
```

### 2. スクリプトのダウンロード

```bash
# GitHubからダウンロード
git clone https://github.com/yourusername/svg2gif-converter.git
cd svg2gif-converter
```

## 使い方

### 基本的な使用方法

1. **起動**
   ```bash
   python svg2gif-converter.py
   ```

2. **SVGファイルを選択**
   - 「参照」ボタンをクリックしてSVGファイルを選択
   - アニメーション時間が自動的に検出されます

3. **設定を調整（必要に応じて）**
   - **フレームレート**: 滑らかさの調整（5-30fps）
   - **総再生時間**: アニメーションのループ回数を制御
   - **オプション**: フェード効果や空白時間の追加

4. **変換**
   - 「変換開始」ボタンをクリック
   - GIFファイルが指定フォルダに保存されます

### 設定項目の詳細

#### 変換設定
- **検出されたアニメーション時間**: SVGから自動検出された1ループの時間
- **フレームレート(fps)**: 5-30の範囲で調整可能
- **総再生時間(秒)**: 実際のGIFの長さ（手動調整可能）
- **総フレーム数**: 自動計算される

#### オプション設定
- **開始前の空白(秒)**: アニメーション開始前の静止時間
- **終了後の空白(秒)**: アニメーション終了後の静止時間
- **フェードイン(秒)**: 徐々に表示される効果
- **フェードアウト(秒)**: 徐々に消える効果
- **デバッグモード**: 詳細な変換情報を出力

### 総再生時間とループの仕組み

総再生時間を調整することで、アニメーションのループ回数を制御できます：

```
例：1.65秒のアニメーションの場合
- 総再生時間 1.65秒 → 1回再生
- 総再生時間 3.3秒 → 2回ループ
- 総再生時間 5.0秒 → 約3回ループ
```

## 対応しているアニメーション

### ✅ 完全対応
- **CSS Animation**: `@keyframes` と `animation` プロパティ
- **Animation-delay**: 要素ごとの遅延開始
- **SMILアニメーション**: `<animate>`, `<animateTransform>`
- **単純な構造のアニメーション**: 直接的な要素アニメーション

### ⚠️ 部分対応（制限あり）
- **複雑な入れ子構造**: アニメーション要素を含むwrapperがさらにアニメーションする場合
  - 例：回転するグループ内で個別に動く要素
  - 現象：タイミングがずれたり、一部のアニメーションが再現されない場合がある
- **Animation-delayの複雑な組み合わせ**: 
  - 非常に短い間隔（0.1秒未満）の連続的なdelay
  - 現象：微妙なタイミングのずれが発生する場合がある

### ❌ 非対応
- **JavaScriptアニメーション**: 動的に制御されるアニメーション
- **インタラクティブ要素**: hover、click等のイベント駆動
- **外部リソース**: 外部CSSファイルやJavaScriptライブラリ

## 既知の問題と制限事項

### 1. 複雑な入れ子アニメーション
アニメーション要素を含むグループ（`<g>`タグなど）がさらにアニメーションする場合、正確に再現できない場合があります。

**例：**
```svg
<g class="rotating-group">  <!-- このグループが回転 -->
  <circle class="pulsing">  <!-- この要素が拡縮 -->
</g>
```

**回避策：**
- 可能な限りフラットな構造でアニメーションを定義
- グループアニメーションと要素アニメーションを分離

### 2. Animation-delayの精度
0.15秒などの細かい`animation-delay`を持つ要素が多数ある場合、微妙なタイミングのずれが発生することがあります。

**影響を受けやすいケース：**
- 10個以上の要素が順番にアニメーションする
- delay間隔が0.1秒未満
- 総アニメーション時間が5秒を超える

**対処法：**
- デバッグモードで実際のタイミングを確認
- 必要に応じて手動で総再生時間を微調整

### 3. ブラウザ依存の描画
SVGの一部の高度な機能（フィルター、マスク、クリッピング）は、ブラウザによって描画結果が異なる場合があります。

## トラブルシューティング

### よくある質問

**Q: アニメーションの一部が再現されない**
A: デバッグモードを有効にして、検出されたアニメーション要素を確認してください。複雑な入れ子構造の場合は、SVGの構造を簡略化することを検討してください。

**Q: タイミングがずれる**
A: 総再生時間を手動で調整するか、フレームレートを変更してみてください。20fpsが最もバランスが良い設定です。

**Q: ファイルサイズが大きい**
A: フレームレートを下げる（15fps程度）か、総再生時間を短くすることでファイルサイズを削減できます。

**Q: Chromeドライバーのエラー**
A: `webdriver-manager`が自動的に適切なバージョンをダウンロードしますが、エラーが続く場合はChromeブラウザを最新版に更新してください。

### エラーメッセージと対処法

```
エラー: SVGファイルが見つかりません
→ ファイルパスに日本語が含まれていないか確認

エラー: 変換処理が既に実行中です
→ 前の変換が完了するまで待つか、アプリを再起動

エラー: 出力フォルダを作成できません
→ 書き込み権限があるフォルダを選択
```

## 技術詳細

### アニメーション検出アルゴリズム

1. **CSS Animation検出**
   - `animation:` ショートハンドプロパティ
   - `animation-duration` の個別指定
   - `animation-delay` の最大値を考慮

2. **SMIL Animation検出**
   - `dur` 属性の解析
   - `begin` 属性による遅延

3. **総時間の計算**
   ```
   総アニメーション時間 = base_duration + max_delay
   ```

### フレーム生成プロセス

1. 各フレームで JavaScript を使用して時間を制御
2. `animation-delay` を負の値に設定してアニメーションを特定の位置に
3. `animation-play-state: paused` で一時停止
4. スクリーンショットをキャプチャ

### 最適化設定

```python
# 推奨設定値
一般的な用途: 20fps, 品質優先
Web用途: 15fps, ファイルサイズ優先  
プレゼンテーション: 25fps, 高品質
```

## 更新履歴

### v1.1.2
- デバッグモードのUI改善
- コードのクリーンアップ

### v1.1.1
- 各要素の元のanimation-delayを保持する制御を実装
- 個別要素のタイミングを独立して管理
- デバッグモードの改善

### v1.1.0
- アニメーション検出の精度向上
- フェード効果の追加
- UIの大幅改善

### v1.0.0
- 初回安定版リリース

## ライセンス

MIT License

## クレジット

このツールは以下のライブラリを使用しています：
- [Pillow](https://python-pillow.org/) - 画像処理
- [Selenium](https://www.selenium.dev/) - ブラウザ自動化
- [webdriver-manager](https://github.com/SergeyPirogov/webdriver_manager) - ChromeDriver管理